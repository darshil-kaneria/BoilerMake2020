<!DOCTYPE html>
<link rel="stylesheet" href="style_main.css">
<!-- -->
<html lang="en" dir="ltr">
  <script src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jzz"></script>
  <script src="https://cdn.jsdelivr.net/npm/jzz-synth-tiny"></script>
  <script src="https://cdn.jsdelivr.net/npm/jzz-input-kbd"></script>
  <script src="https://cdn.jsdelivr.net/npm/jzz-midi-smf"></script>
  <head>
    <meta charset="utf-8">
    <title>BoilerMake 2020</title>
    <h2>&#127925; Music Generation &#127925;</h2>
  </head>
  <body>
    <h3>Upload a short recorded midi file. Press the play button to generate a unique sequence similar to the theme of the clip that you uploaded.</h3>
    <div class="fileInput">
      <h4>&#127911; Input a .mid file</h4>
      <input type=file id=file onchange='fromFile()'>
      <p id=log>no file selected</p>
    </div>
    <!--
    <div class="record">
      <h4>&#127908; Record a file</h4>
      <button id=record name="recording" onclick='recordStop()'>Record</button>
      <span class="dot"></span>
    </div>
    -->
    <h4 class="header1">The Generated Song</h4>
    <p><button class="play" id=btn onclick='playStop()' disabled>Play</button></p>
    <script>
      var log = document.getElementById('log');
      var btn = document.getElementById('btn');
      function report(s) { return function() { log.innerHTML = s; }; }

      JZZ.synth.Tiny.register('Web Audio');
      var out = JZZ().or(report('Cannot start MIDI engine!')).openMidiOut().or(report('Cannot open MIDI Out!'));
      var player;
      var playing = false;

      function clear() {
        if (player) player.stop();
        playing = false;
        btn.innerHTML = 'Play';
        btn.disabled = true;
      }

      function load(data, name) {
        try {
          player = JZZ.MIDI.SMF(data).player();
          player.connect(out);
          player.onEnd = function() {
            playing = false;
            btn.innerHTML = 'Play';
          }
          playing = false;
          player.play();
          log.innerHTML = name;
          btn.innerHTML = 'Stop';
          btn.disabled = false;
        }
        catch (e) {
          log.innerHTML = e;
        }
      }

      function playStop() {
        if (playing) {
          player.stop();
          playing = false;
          btn.innerHTML = 'Play';
        }
        else {
          player.play();
          playing = true;
          btn.innerHTML = 'Stop';
        }
      }

      function fromFile() {
        clear();
        var reader = new FileReader();
        var f = document.getElementById('file').files[0];
        reader.onload = function(e) {
          var data = '';
          var bytes = new Uint8Array(e.target.result);
          for (var i = 0; i < bytes.length; i++) {
            data += String.fromCharCode(bytes[i]);
          }

          

          load(data, f.name);
        };
        reader.readAsArrayBuffer(f);
      }
    </script>
    <p class="details"> This music is generated by passing a random noise sequence through a trained LSTM network. This LSTM is trained over 92 midi files for over 200 epochs </p>
    <h4 class="references">References</h4>
    <ul>
      <li><a href="https://github.com/Skuldur/Classical-Piano-Composer">Classical-Piano-Composer</a> by Skuldur</li>
      <li><a href="https://arxiv.org/ftp/arxiv/papers/1908/1908.01080.pdf">LSTM Based Music Generation System</a> by Sanidhya Mangal, Rahul Modak, and Poorva Joshi</li>
      <li><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/">Time series prediction using LSTM - RNN</a> by Jason Brownlee</li>

    </ul>
  </body>
  <footer>
    <h5>Made in January 2020. By: Darshil, Vidit, and Katherine.</h5>
  </footer>
</html>
